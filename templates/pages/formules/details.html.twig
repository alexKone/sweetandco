{% extends 'base.html.twig' %}

{% block body %}
  {% if formule %}
    {#<h1 class="center-align truncate">{{ formule.name }}</h1>#}
    <input type="hidden" name="id[]" value="{{ formule.price }}" />
    <input type="hidden" name="details" data-ingredients="{{ formule.limitIngredient }}">


    <form class="container" method="post">

      <section class="content base">
        <div class="title-page col-12 pt-0 text-center wrapper--sm">
          <div class="numero--sm tahu h1">1</div>
          <h2 class="h1 titre-deco">
            <span>Choisissez votre base...</span>
          </h2>
        </div>
        {#<div class="content__title">#}
          {#<span>1</span>#}
          {#<h2>Choisissez la base...</h2>#}
        {#</div>#}
        <div class="content__items">
          <ul>
            {% for base in bases %}
              <li>
                <label>
                  <img loading="lazy" src="{{ vich_uploader_asset(base, 'imageFile') }}" alt="">
                  <input type="radio" name="base" value="{{ base.id }}" required>
                  <span>{{ base.name }}</span>
                </label>
              </li>
            {% endfor %}
          </ul>
        </div>
      </section>

      <section class="content ingredients">
        <div class="title-page col-12 pt-0 text-center wrapper--sm">
          <div class="numero--sm tahu h1">2</div>
          <h2 class="h1 titre-deco">
            <span>Choisissez vos {{ formule.limitIngredient }} ingredients...</span>
          </h2>
        </div>

        {#<div class="content__title">#}
          {#<span>2</span>#}
          {#<h2>Choisissez vos ingredients...</h2>#}
        {#</div>#}
        <div class="content__items">
          <ul>
            {% for ingredient in ingredients %}
              <li>
                <label>
                  <img loading="lazy" src="{{ vich_uploader_asset(ingredient, 'imageFile') }}" alt="" />
                  <input type="checkbox" name="ingredient_{{ ingredient.id }}" value="{{ ingredient.id }}" />
                  <span>{{ ingredient.name }}</span>
                </label>
              </li>
            {% endfor %}
          </ul>
        </div>
      </section>

      <section class="content sauce">
        <div class="title-page col-12 pt-0 text-center wrapper--sm">
          <div class="numero--sm tahu h1">3</div>
          <h2 class="h1 titre-deco">
            <span>Choisissez votre sauce...</span>
          </h2>
        </div>
        {#<div class="content__title">#}
          {#<span>3</span>#}
          {#<h2>Choisissez la sauce...</h2>#}
        {#</div>#}
        <div class="content__items">
          <ul>
            {% for sauce in sauces %}
              <li>
                <label>
                  <img loading="lazy" src="{{ vich_uploader_asset(sauce, 'imageFile') }}" alt="">
                  <input type="radio" name="sauce" value="{{ sauce.id }}" required>
                  <span>{{ sauce.name }}</span>
                </label>
              </li>
            {% endfor %}
          </ul>
        </div>
      </section>

      {% if formule.hasBagel %}
        <section class="content bagel">
          <div class="title-page col-12 pt-0 text-center wrapper--sm">
            <div class="numero--sm tahu h1">1</div>
            <h2 class="h1 titre-deco">
              <span>Choisissez votre bagel...</span>
            </h2>
          </div>
          {#<div class="content__title">#}
            {#<span>3</span>#}
            {#<h2>Choisissez le bagel...</h2>#}
          {#</div>#}
          <div class="content__items">
            <ul>
              {% for bagel in bagels %}
                <li>
                  <label>
                    <img loading="lazy" src="{{ vich_uploader_asset(bagel, 'imageFile') }}" alt="">
                    <input type="radio" name="bagel" value="{{ bagel.id }}" required>
                    <span>{{ bagel.name }}</span>
                  </label>
                </li>
              {% endfor %}
            </ul>
          </div>
        </section>
      {% endif %}

      {% if formule.hasPanini %}
        <section class="content panini">
          <div class="title-page col-12 pt-0 text-center wrapper--sm">
            <div class="numero--sm tahu h1">1</div>
            <h2 class="h1 titre-deco">
              <span>Choisissez votre panini...</span>
            </h2>
          </div>
          {#<div class="content__title">#}
            {#<span>3</span>#}
            {#<h2>Choisissez le panini...</h2>#}
          {#</div>#}
          <div class="content__items">
            <ul>
              {% for panini in paninis %}
                <li>
                  <label>
                    <img loading="lazy" src="{{ vich_uploader_asset(panini, 'imageFile') }}" alt="">
                    <input type="radio" name="panini" value="{{ panini.id }}" required>
                    <span>{{ panini.name }}</span>
                  </label>
                </li>
              {% endfor %}
            </ul>
          </div>
        </section>
      {% endif %}

      {% if formule.hasBoisson %}
        <section class="content boisson">
          <div class="title-page col-12 pt-0 text-center wrapper--sm">
            <div class="numero--sm tahu h1">1</div>
            <h2 class="h1 titre-deco">
              <span>Choisissez votre boisson...</span>
            </h2>
          </div>
          {#<div class="content__title">#}
            {#<span>3</span>#}
            {#<h2>Choisissez la boisson...</h2>#}
          {#</div>#}
          <div class="content__items">
            <ul>
              {% for boisson in boissons %}
                <li>
                  <label>
                    <img loading="lazy" src="{{ vich_uploader_asset(boisson, 'imageFile') }}" alt="">
                    <input type="radio" name="boisson" value="{{ boisson.id }}" required>
                    <span>{{ boisson.name }}</span>
                  </label>
                </li>
              {% endfor %}
            </ul>
          </div>
        </section>
      {% endif %}

      {% if formule.hasDessert %}
        <section class="content dessert">
          <div class="title-page col-12 pt-0 text-center wrapper--sm">
            <div class="numero--sm tahu h1">1</div>
            <h2 class="h1 titre-deco">
              <span>Choisissez votre dessert...</span>
            </h2>
          </div>
          {#<div class="content__title">#}
            {#<span>3</span>#}
            {#<h2>Choisissez le dessert...</h2>#}
          {#</div>#}
          <div class="content__items">
            <ul>
              {% for dessert in desserts %}
                <li>
                  <label>
                    <img loading="lazy" src="{{ vich_uploader_asset(sauce, 'imageFile') }}" alt="">
                    <input type="radio" name="dessert" value="{{ dessert.id }}" required>
                    <span>{{ dessert.name }}</span>
                  </label>
                </li>
              {% endfor %}
            </ul>
          </div>
        </section>
      {% endif %}

      <div style="margin-top: 100px"></div>

      <button type="submit">Valider</button>

    </form>

  {% endif %}
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script>
    function addClass(elts, target) {
      elts.forEach(elt => elt.addEventListener('click', evt => {
        for (let i = 0; i < elts.length; i++) {
          elts[i].classList.remove('is-active')
        }
        elt.classList.add('is-active')
        smoothScroll(target, 2000)
      }))
    }
    function smoothScroll(target, duration) {
      var target = document.getElementById(target);
      var targetPosition = target.getBoundingClientRect().top;
      var startPosition = window.pageYOffset;
      var distance = targetPosition - startPosition;
      var startTime = null;

      function animation(currentTime) {
        if (startTime === null) startTime = currentTime;
        var timeElapsed = currentTime - startTime;
        var run = ease(timeElapsed, startPosition, distance, duration);
        window.scrollTo(0, run);
        if (timeElapsed < duration) requestAnimationFrame(animation);
      }

      function ease(t, b, c, d) {
        t /= d / 2;
        if (t < 1) return c / 2 * t * t + b;
        t--;
        return -c / 2 * (t * (t - 2) - 1) + b;
      }

      requestAnimationFrame(animation);
    }


    const baseElts = document.querySelectorAll('.base .content__items>ul>li');
    const sauceElts = document.querySelectorAll('.sauce .content__items>ul>li');

    addClass(baseElts, '.ingredients');
    addClass(sauceElts, '');

    let nbIngredients = Number(document.querySelector('input[name="details"]').getAttribute('data-ingredients'));
    let inputElts = document.querySelectorAll('.ingredients input[type="checkbox"]');
    let count = 0;
    let arr = [];

    console.log(nbIngredients)
    inputElts.forEach(elt => elt.addEventListener('change', evt => {
      arr = [];
      for (let i = 0; i < inputElts.length; i++) {
        inputElts[i].checked ? arr = [...arr, inputElts[i].checked] : '';
      }
      count = arr.length;
      if (count === nbIngredients) {
        console.log('le conpte y est')
        inputElts.forEach(element => element.checked ? '' : element.setAttribute('disabled', 'disabled') )
        smoothScroll('.sauce', 1000)
      }
      if (count < nbIngredients) {
        inputElts.forEach(i => {
          if (i.getAttribute('disabled', 'disabled')) {
            i.removeAttribute('disabled');
          }
        })
      }
    }))



  </script>
{% endblock %}
