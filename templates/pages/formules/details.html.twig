{% extends 'base.html.twig' %}

{% block body %}
  {% if formule %}
    <h1>{{ formule.name }}</h1>
    <input type="hidden" name="id[]" value="{{ formule.price }}" />
    <input type="hidden" name="details" data-ingredients="{{ formule.limitIngredient }}">


    <form method="post">
      <section class="bases">
        <h3>Les bases</h3>

        <div class="row">
          {% for base in bases %}
          <li class="col s6">
            <label>
              <img class="img-list" src="{{ vich_uploader_asset(base, 'imageFile') }}" alt="">
              <input id="_base_{{ base.id }}" type="radio" value="{{ base.id }}" name="base" required>
            </label>
            {#<label for="_base_{{ base.id }}">{{ base.name }}</label>#}
          </li>
        {% endfor %}
        </div>
      </section>

      <section class="ingredients">
        <h3>Les ingredients</h3>
        {% for ingredient in ingredients %}
          <li>
            <label>
              <img src="{{ vich_uploader_asset(ingredient, 'imageFile') }}" alt="">
              <input id="_ingredient_{{ ingredient.id }}" type="checkbox" name="ingredient_{{ ingredient.id }}" value="{{ ingredient.id }}" />
              <span>{{ ingredient.name }}</span>
            </label>
            {#<label for="_ingredient_{{ ingredient.id }}">{{ ingredient.name }}</label>#}
          </li>
        {% endfor %}
      </section>

      <section class="bases">
        <h3>Les Sauces</h3>

        <div class="row">
          {% for sauce in sauces %}
            <li class="col s6">
              <label>
                <img class="img-list" src="{{ vich_uploader_asset(sauce, 'imageFile') }}" alt="">
                <input id="_sauce_{{ sauce.id }}" type="radio" value="{{ sauce.id }}" name="sauce" required>
              </label>
              {#<label for="_base_{{ base.id }}">{{ base.name }}</label>#}
            </li>
          {% endfor %}
        </div>
      </section>

        {#{% for sauce in sauces %}#}
          {##}
          {##}
          {##}
          {#<li>#}
            {#<img src="{{ vich_uploader_asset(sauce, 'imageFile') }}" alt="">#}
            {#<input id="_sauce_{{ formule.id }}" type="radio" value="{{ sauce.id }}" name="sauce" required>#}
            {#<label for="_sauce_{{ formule.id }}">{{ sauce.name }}</label>#}
          {#</li>#}
        {#{% endfor %}#}
      </section>

    {% if formule.hasBagel %}
      <section class="bagels">
        <h3>les bagels</h3>
      </section>
    {% endif %}
    {% if formule.hasPanini %}
      <section class="paninis">
        <h3>les paninis</h3>
      </section>
    {% endif %}


      <button type="submit">Valider</button>

    </form>

  {% endif %}
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script>
    const listBases = document.querySelectorAll('.bases>.row>li');
    listBases.forEach(base => {
      base.addEventListener('click', evt => {
        listBases.forEach(b => {
          if (b.classList.contains('is-selected'))
            b.classList.remove('is-selected')
        });
        base.classList.add('is-selected')
        // b.classList.add('is-selected')
        // console.log(base, evt.target)
      })
    })

    let nbIngredients = Number(document.querySelector('input[name="details"]').getAttribute('data-ingredients'));
    let inputElts = document.querySelectorAll('.ingredients input[type="checkbox"]');
    let count = 0;
    let arr = [];

    console.log(nbIngredients)
    inputElts.forEach(elt => elt.addEventListener('change', evt => {
      arr = [];
      for (let i = 0; i < inputElts.length; i++) {
        inputElts[i].checked ? arr = [...arr, inputElts[i].checked] : '';
      }
      count = arr.length;
      if (count === nbIngredients) {
        console.log('le conpte y est')
        inputElts.forEach(element => element.checked ? '' : element.setAttribute('disabled', 'disabled') )

      }
      if (count < nbIngredients) {
        inputElts.forEach(i => {
          if (i.getAttribute('disabled', 'disabled')) {
            i.removeAttribute('disabled');
          }
        })
      }
    }))

  </script>
{% endblock %}
