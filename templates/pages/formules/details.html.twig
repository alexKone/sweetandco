{% extends 'base.html.twig' %}

{% block body %}
  {% if formule %}
    <h1 class="center-align truncate">{{ formule.name }}</h1>
    <input type="hidden" name="id[]" value="{{ formule.price }}" />
    <input type="hidden" name="details" data-ingredients="{{ formule.limitIngredient }}">


    <form class="container" method="post">

      <section class="bases">
        <h3>Les bases</h3>

        <div class="row">
          {% for base in bases|sortByField('name') %}
          <li class="item col s6 m4 l3">
            <label>
              <img class="img-list" src="{{ vich_uploader_asset(base, 'imageFile') }}" alt="">
              <input id="_base_{{ base.id }}" type="radio" value="{{ base.id }}" name="base" required>
              <span>{{ base.name }}</span>
            </label>
            {#<label for="_base_{{ base.id }}">{{ base.name }}</label>#}
          </li>
        {% endfor %}
        </div>
      </section>

      <section class="ingredients">
        <h3>Les ingredients <span class="anot">({{ formule.limitIngredient }} au choix)</span></h3>
        <div class="row">

          {% if subCategory %}
            {% for sub in subCategory %}
              {% if sub.ingredients|length > 0 %}
                <h5 class="center-align">{{ sub.name }}</h5>
                <ul class="row">
                  {% for ingredient in sub.ingredients|sortByField('name') %}
                    <li class="item col s6 m4 l3">
                      <label class="checkbox">
                        <img src="{{ vich_uploader_asset(ingredient, 'imageFile') }}" alt="">
                        <input id="_ingredient_{{ ingredient.id }}" type="checkbox" name="ingredient_{{ ingredient.id }}" value="{{ ingredient.id }}" />
                        <span>{{ ingredient.name }}</span>
                      </label>
                    </li>
                  {% endfor %}
                </ul>
              {% endif %}
            {% endfor %}
          {% endif %}

          {#{% for ingredient in ingredients|sortByField('name') %}#}
            {#<li class="col s6 m4 l3">#}
              {#<label class="checkbox">#}
                {#<img src="{{ vich_uploader_asset(ingredient, 'imageFile') }}" alt="">#}
                {#<input id="_ingredient_{{ ingredient.id }}" type="checkbox" name="ingredient_{{ ingredient.id }}" value="{{ ingredient.id }}" />#}
                {#<span>{{ ingredient.name }}</span>#}
              {#</label>#}
              {#<label for="_ingredient_{{ ingredient.id }}">{{ ingredient.name }}</label>#}
            {#</li>#}
          {#{% endfor %}#}
        </div>
      </section>


      <section class="bases">
        <h3>Les Sauces</h3>

        <div class="row">
          {% for sauce in sauces|sortByField('name') %}
            <li class="item col s6 m4 l3">
              <label>
                <img class="img-list" src="{{ vich_uploader_asset(sauce, 'imageFile') }}" alt="">
                <input id="_sauce_{{ sauce.id }}" type="radio" value="{{ sauce.id }}" name="sauce" required>
                <span>{{ sauce.name }}</span>
              </label>
              {#<label for="_base_{{ base.id }}">{{ base.name }}</label>#}
            </li>
          {% endfor %}
        </div>
      </section>


    {% if formule.hasBagel %}
      <h3>Les bagels</h3>
      <div class="row">
        {% for bagel in bagels|sortByField('name') %}
          <li class="item col s6 m4 l3">
            <label>
              <img class="img-list" src="" alt="" />
              <input type="radio" name="bagel" value="{{ bagel.id }}" required />
              <span>{{ bagel.name }}</span>
            </label>
          </li>
        {% endfor %}

      </div>
    {% endif %}

    {% if formule.hasPanini %}

      <h3>Les paninis</h3>
      <div class="row">
        {% for panini in paninis|sortByField('name') %}
          <li class="item col s6 m4 l3">
            <label>
              <img class="img-list" src="" alt="" />
              <input type="radio" name="panini" value="{{ panini.id }}" required />
              <span>{{ panini.name }}</span>
            </label>
          </li>
        {% endfor %}

      </div>
    {% endif %}

    {% if formule.hasBoisson %}
      <h3>Les boissons</h3>
      <div class="row">
        {% for boisson in boissons|sortByField('name') %}
          <li class="item col s6 m4 l3">
            <label>
              <img class="img-list" src="" alt="" />
              <input type="radio" name="boisson" value="{{ boisson.id }}" required />
              <span>{{ boisson.name }}</span>
            </label>
          </li>
        {% endfor %}

      </div>
    {% endif %}

    {% if formule.hasDessert %}

      <h3>Les desserts</h3>
      <div class="row">
        {% for dessert in desserts|sortByField('name') %}
          <li class="item col s6 m4 l3">
            <label>
              <img class="img-list" src="" alt="" />
              <input type="radio" name="dessert" value="{{ dessert.id }}" required />
              <span>{{ dessert.name }}</span>
            </label>
          </li>
        {% endfor %}

      </div>
    {% endif %}


      <button type="submit">Valider</button>

    </form>

  {% endif %}
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script>
    const listBases = document.querySelectorAll('.bases>.row>li');
    listBases.forEach(base => {
      base.addEventListener('click', evt => {
        listBases.forEach(b => {
          if (b.classList.contains('is-selected'))
            b.classList.remove('is-selected')
        });
        base.classList.add('is-selected')
        // b.classList.add('is-selected')
        // console.log(base, evt.target)
      })
    })

    let nbIngredients = Number(document.querySelector('input[name="details"]').getAttribute('data-ingredients'));
    let inputElts = document.querySelectorAll('.ingredients input[type="checkbox"]');
    let count = 0;
    let arr = [];

    console.log(nbIngredients)
    inputElts.forEach(elt => elt.addEventListener('change', evt => {
      arr = [];
      for (let i = 0; i < inputElts.length; i++) {
        inputElts[i].checked ? arr = [...arr, inputElts[i].checked] : '';
      }
      count = arr.length;
      if (count === nbIngredients) {
        console.log('le conpte y est')
        inputElts.forEach(element => element.checked ? '' : element.setAttribute('disabled', 'disabled') )

      }
      if (count < nbIngredients) {
        inputElts.forEach(i => {
          if (i.getAttribute('disabled', 'disabled')) {
            i.removeAttribute('disabled');
          }
        })
      }
    }))

  </script>
{% endblock %}
